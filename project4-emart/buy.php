<?phpsession_start();error_reporting(0);?><!********starting of html code************><html><head>    <title>Emart Store</title>    <style>        table {  border:2.5px solid black; border-collapse:collapse; text-align:left  }        td {  border:1px solid grey; height:110px;  }        tr: hover {  background-color:  #aed6f1 ; transition:all 400ms ease;  }    </style></head><body style="background-color:#ECF0F1; color:black;"><!***************for searching the products***************> <?phpif($_GET['submitForm']) {    if(!isset($dropId)) {                   //to select the category        $dropId = $_GET["selectCat"];    }	    if(!isset($check)) {                           $check = urlencode($_GET["checkText"]); //for searching the product using the checkbox    }        if($check == null) {        $wrongSearch = "Enter a search text above";    } else {        $searchResult = file_get_contents("http://sandbox.api.shopping.com/publisher/3.0/rest/GeneralSearch?apiKey=78b0db8a-0ee1-4939-a2f9-d3cd95ec0fcc&visitorUserAgent&visitorIPAddress&trackingId=7000610&categoryId=". $dropId . "&keyword=" . $check . "&numItems=20&showProductOffers=false");        $checkResult = new SimpleXMLElement($searchResult);        if (count($checkResult->categories->category->items)!=null) {            $checkResultResponseText = "Search results for ";            $isAsFollows = " is as follows: ";        } else {            $checkResultResponseText = "No search results found for ";            $isAsFollows = "Type the right keyword";        }    }}?><!****************for adding the elements in the cart************><?phpif (!isset($_SESSION['cartElem'])) {     $_SESSION['cartElem'] = array ();  }if(!isset($_SESSION['costSum'])) {    $_SESSION['costSum'] = (float)0;   }if($_GET['purchaseItem']) {                     $list = $_GET['purchaseItem'];          $listDetails = file_get_contents("http://sandbox.api.ebaycommercenetwork.com/publisher/3.0/rest/GeneralSearch?apiKey=78b0db8a-0ee1-4939-a2f9-d3cd95ec0fcc&visitorUserAgent&visitorIPAddress&trackingId=7000610&productId=".$list);    $details = new SimpleXMLElement($listDetails);    $elemName = (string)$details->categories->category->items->product->name;    $elemImage = (string)$details->categories->category->items->product->images->image[0]->sourceURL;    $elemPrice = (float)$details->categories->category->items->product->minPrice;    $elemUrl = (string)$details->categories->category->items->product->productOffersURL;    $elemId = (double)$details->categories->category->items->product['id'];    if(array_key_exists($_GET['purchaseItem'],$_SESSION['cartElem'])==false) {        $itemsAdded = "<b>".$elemName ."</b><br /> successfully added to the cart";    } else {        $itemsPresent = $elemName ."<br /> already present in the cart";    }    if(array_key_exists($_GET['purchaseItem'],$_SESSION['cartElem'])==false) {        $_SESSION['costSum'] += (float)$elemPrice;    }    $_SESSION['cartElem'][$_GET['purchaseItem']]['id'] = $elemId;    $_SESSION['cartElem'][$_GET['purchaseItem']]['name'] = $elemName;    $_SESSION['cartElem'][$_GET['purchaseItem']]['image'] = $elemImage;    $_SESSION['cartElem'][$_GET['purchaseItem']]['price'] = (float)$elemPrice;    $_SESSION['cartElem'][$_GET['purchaseItem']]['url'] = $elemUrl;}?><!***************for search history************************><?phpif (!isset($_SESSION['searchHistory'])) {     $_SESSION['searchHistory'] = array ();  }if (!isset($_SESSION['sea'])) {     $_SESSION['sea'] = 0;  }?><!************* for deleting cart elements and clearing the cart********************> <?php//for deleting the elements in the cart individuallyif($_GET['deleteElem']) {    $deleteCartElem = $_GET['deleteElem'];       if(array_key_exists($_GET['deleteElem'],$_SESSION['cartElem'])==true) {        $_SESSION['costSum'] -= (float)$_SESSION['cartElem'][$deleteCartElem]['price'];        $elemDeleted = "<b>".$_SESSION['cartElem'][$_GET['deleteElem']]['name'] ."</b><br /> successfully deleted from the cart";    }     unset($_SESSION['cartElem'][$deleteCartElem]);}// for clearing the cartif($_GET['clearList']) {    if(!empty($_SESSION['cartElem'])) {        unset($_SESSION['cartElem']);        $_SESSION['costSum'] = 0;        $clearListResponseText = "<p style='padding-top:10px;padding-bottom:10px'>"."<em><b>Cart Cleared!</b></em>"."\n\t</p>\n";    } else {       $cleanCart = "<p style='padding-top:10px;padding-bottom:10px'>"."        <em><b>No items in cart to be cleared</b></em>".            "\n\t</p>\n";    }}?><!**************************html code***************************************><!*************search area*******><div id="formDiv">    <form action="buy.php" method="GET">        <?php        $categoryStr = file_get_contents("http://sandbox.api.ebaycommercenetwork.com/publisher/3.0/rest/CategoryTree?apiKey=78b0db8a-0ee1-4939-a2f9-d3cd95ec0fcc&visitorUserAgent&visitorIPAddress&trackingId=7000610&categoryId=72&showAllDescendants=true");        $category = new SimpleXMLElement($categoryStr);        ?>        <fieldset style="border-radius:8px" class="">            <legend style="margin-left:80px;font-size:16px">Search</legend>            <label style="margin-left:15px">Category:&nbsp;&nbsp;&nbsp;</label>            <select name="selectCat" style="width:270px;">                <?php                foreach($category->category as $selectCategory) {                    echo "\n\t\t\t";                    echo "<option value='".$selectCategory['id']."'>".$selectCategory->name."</option>" ;                    echo "\n\n";                    foreach($selectCategory->categories->category as $categoryGroup) {                        echo "\t\t\t";                        echo "<option value='" . $categoryGroup['id'] . "'>".$categoryGroup->name."</option>";                        echo "\n\t\t\t\t";                        echo "<optgroup label='" . $categoryGroup->name . "' value='" . $categoryGroup['id'] . "'>" . "\n";                        foreach ($categoryGroup->categories as $cat) {                            foreach ($cat->children() as $subCat) {                                echo "\t\t\t\t\t";                                echo "<option value='" . $subCat['id'] . "'>" . $subCat->name . "</option>\n";                            }                        }                        echo "\t\t\t\t" . "</optgroup>" . "\n";                        echo "\n";                    }                }                ?>            </select>            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            <input name="checkText" type="text" placeholder="Type to Search here"  />            <button class="w3-btn w3-white w3-hover-green" name="submitForm" type="submit" value="submitted" >Search Items</button>        </fieldset>    </form></div><!*****************cart display**********************><div id="cartElemDiv" style="height:350px">        <div>        <div id="tableContents" style="min-height:200px;max-height:350px;overflow:auto;">	<div border=0px >	<label>Cart Elements:</label><?= count($_SESSION['cartElem']) ?> <br/>	<label>Total Amount:</label>$<?= $_SESSION['costSum'] ?>        </div>            <table >                <?php                foreach($_SESSION['cartElem'] as $elemList) {?>                    <tr >                        <td><img src="<?=$elemList['image']?>"/></a></td>                        <td><?=$elemList['name']?></td>                        <td style="width:85px;font-size:14px;text-align:center">$<?=$elemList['price'] ?></td>			<td><a href="<?=$elemList['url'] ?>" target="_blank"><button type="button">Description</button>			</td>                        <td style="width:60px;text-align:center">                            <a href="buy.php?deleteElem=<?=$elemList['id'] ?>">Delete</a>                        </td>                    </tr>                <?php } "\n"?>            </table>        </div>    </div>    </div><!******************clearing the cart***************><div id="clearListDiv" class="w3-row">    <div class="w3-col m2 w3-center" style="margin-top:7px">        <form action="buy.php" method="get">            <button type="submit" name="clearList" value="empty">Remove Elements From Cart</button>        </form>    </div></div><!*****************search display***********************><p  style="margin-bottom:5px">    <?=$checkResultResponseText?><b style="color:blue"><?=$check?></b><?=$isAsFollows?></p><p style="margin-bottom:5px">    <?=$wrongSearch?></p><div>    <div id="searchResultTableDiv" style="min-height:150px;max-height:285px;overflow:auto;">        <table style="">            <?php            foreach ($checkResult->children() as $group) {                if($group->getName() == "categories") {                    foreach ($group->category->items->product as $items) {                         echo "\n";                        $prodName = $items->name;                        $proddescription = $items->fullDescription;                        $prodprice = $items->minPrice;                        $prodimageSource = $items->images->image[0]->sourceURL;                        $proditemId = $items['id'];
   $k=0;
    $_SESSION['searchHistory']['k']['id'] = $searchitemId;    $_SESSION['searchHistory']['k']['name'] = $searchName;    $_SESSION['searchHistory']['k']['image'] = $searchimageSource;    $_SESSION['searchHistory']['k']['price'] = (float)$searchprice;    $_SESSION['searchHistory']['k']['description'] = $searchdescription;
    				                        echo "\t\t\t<tr>\n";                        echo "\t\t\t\t<td><a href=buy.php?purchaseItem=". $proditemId ."><img src='" . $prodimageSource . "' /></a></td>\n";                        echo "\t\t\t\t<td>" . $prodName . "</td>\n";                        echo "\t\t\t\t<td style='width:65px;'><p style='font-size:12px;margin-left:5px;padding:0px'>$". $prodprice . "</p></td>\n";                        echo "\t\t\t\t<td style='font-size:14px'>" . $proddescription . "</td>\n";			echo "\t\t\t\t<td><a href=".$items->productOffersURL. " target='_blank' /><button type='button'>Check on site</button></td>";                         echo "\t\t\t</tr>\n\n";

			$k++;
			$_SESSION['sea']=$k;                    }                }            }
/*	 echo "<div>Search history\n\n";
	foreach($_SESSION['searchHistory'] as $id=>$val)
{
echo "\nprice" .$val['price']." Product name " .$val['name']." <br/></div>\n" ;
}*/            ?>        </table>    </div></div><!***************displaying search history********************>
<!*************responses***********><div name="clearListResponse" class = "w3-center w3-green w3-animate-opacity w3-card-4">    <?= $clearListResponseText ?></div><div>    <?=$cleanCart ?></div><div><p><?= $elemDeleted ?></p></div><div><p><?= $itemsAdded ?></p></div><div><p><?= $itemsPresent ?></p></div><div><p><?= $elemAbsent ?></p></div></body></html>